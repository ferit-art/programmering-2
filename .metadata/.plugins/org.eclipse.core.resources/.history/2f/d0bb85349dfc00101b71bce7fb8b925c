package uppgifter;

import java.awt.Image;
import java.awt.event.*;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.Iterator;

import javax.swing.ImageIcon;

import se.egy.graphics.*;
import upp2.Shape;

// uppgift 1 / uppgift 5

public class GameMain implements KeyListener {

	private boolean gameRunning = true;
	private long lastUpdateTime;

	private GameScreen GameScreen = new GameScreen("Game", 1000, 800, false);

	private HashMap<String, Boolean> keyDown = new HashMap<>();

	private ArrayList<Entity> spriteList = new ArrayList<>();
	private Entity ship;
	private Entity[] aliens = new Entity[5];

	public GameMain() {
		GameScreen.setKeyListener(this);

		keyDown.put("left", false);
		keyDown.put("right", false);
		keyDown.put("down", false);
		keyDown.put("up", false);
		loadImages();
		gameLoop();
	}

	// uppgift 2 / uppgift 5

	public void loadImages() {
		Image shipImg = new ImageIcon(getClass().getResource("/ship.png")).getImage();

		int x = GameScreen.getWidth() - (GameScreen.getWidth() / 2 + shipImg.getWidth(null) / 2);
		int y = GameScreen.getHeight() - (10 + shipImg.getHeight(null));

		ship = new ShipEntity(shipImg, x, y, 800);
		spriteList.add(ship);

		for (int i = 0; i < aliens.length; i++) {
			Image alienImg = new ImageIcon(getClass().getResource("/alien.png")).getImage();

			int a = GameScreen.getWidth() - (GameScreen.getWidth() / 2 + alienImg.getWidth(null) / 2) - 25;
			int b = 0;

			aliens[i] = new AlienEntity(alienImg, a + 10*i, b, 20);
		}
		spriteList.add(aliens);
	}

	// uppgift 3

	public void update(long deltaTime) {
		if (keyDown.get("right") && GameScreen.getWidth() > ship.xPos + ship.getWidth()) {
			ship.setDirectionX(1);
		} else if (keyDown.get("left") && 0 < ship.xPos) {
			ship.setDirectionX(-1);
		} else if (keyDown.get("up") && 0 < ship.yPos) {
			ship.setDirectionY(-1);
		} else if (keyDown.get("down") && GameScreen.getHeight() > ship.yPos + ship.getHeight()) {
			ship.setDirectionY(1);
		} else {
			ship.setDirectionY(0);
			ship.setDirectionX(0);
		}
		ship.move(deltaTime);

		// uppgift 4 / uppgift 5
		if (GameScreen.getHeight() > alien.yPos + alien.getHeight()) {
			alien.move(deltaTime);
		}
	}

	public void render() {
		GameScreen.render(alien);
		GameScreen.render(ship);
	}

	public void gameLoop() {
		/** Läser av systemtiden i nanosekunder */
		lastUpdateTime = System.nanoTime();

		while (gameRunning) {
			/** Tiden som gått sedan senaste uppdateringen */
			long deltaTime = System.nanoTime() - lastUpdateTime;
			lastUpdateTime = System.nanoTime();

			update(deltaTime);
			render();
		}
	}

	/** Spelets tangentbordslyssnare */
	public void keyPressed(KeyEvent e) {
		int key = e.getKeyCode();

		if (key == KeyEvent.VK_W) {
			keyDown.put("up", true);
		} else if (key == KeyEvent.VK_S) {
			keyDown.put("down", true);
		} else if (key == KeyEvent.VK_A) {
			keyDown.put("left", true);
		} else if (key == KeyEvent.VK_D) {
			keyDown.put("right", true);
		}
	}

	public void keyReleased(KeyEvent e) {
		int key = e.getKeyCode();

		if (key == KeyEvent.VK_W) {
			keyDown.put("up", false);
		} else if (key == KeyEvent.VK_S) {
			keyDown.put("down", false);
		} else if (key == KeyEvent.VK_A) {
			keyDown.put("left", false);
		} else if (key == KeyEvent.VK_D) {
			keyDown.put("right", false);
		}
	}

	public void keyTyped(KeyEvent e) {
	}

	public static void main(String[] args) {
		new GameMain();
	}
}
